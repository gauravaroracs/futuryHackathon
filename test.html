<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Green Impact Wallet — Interests & Persona</title>
<style>
  :root{
    --bg:#0b0e11; --card:#131820; --ink:#f7fafc; --muted:#a8b3bf;
    --green:#22c55e; --green-ink:#062b16; --red:#ef4444; --focus:#93c5fd;
    --stroke:#243244;
  }
  html,body{height:100%}
  body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Arial,sans-serif; background:var(--bg); color:var(--ink); -webkit-font-smoothing:antialiased}
  .wrap{max-width:840px; margin:0 auto; padding:16px}
  header{display:flex; align-items:center; justify-content:space-between; margin:2px 0 14px}
  header h1{font-size:18px; margin:0; font-weight:800; letter-spacing:.2px}
  .brand{display:flex; gap:8px; align-items:center}
  .badge{background:var(--green); color:var(--green-ink); border-radius:999px; padding:4px 10px; font-weight:800; font-size:12px}
  .card{background:var(--card); border:1px solid var(--stroke); border-radius:16px; padding:14px}
  fieldset{border:0; margin:0; padding:0}
  legend{font-size:12px; text-transform:uppercase; letter-spacing:.12em; color:var(--muted); margin:0 0 8px}
  .sub{font-size:12px; color:var(--muted); font-weight:700; margin:10px 0 6px}
  .row{display:flex; flex-wrap:wrap; gap:8px}
  .group{margin-top:6px}
  .chip{appearance:none; border:1.5px solid var(--stroke); background:transparent; color:var(--ink); padding:10px 12px; border-radius:999px; font-weight:700; font-size:14px; cursor:pointer; min-height:44px; min-width:44px; display:inline-flex; align-items:center; gap:8px}
  .chip[aria-checked="true"], .chip[aria-pressed="true"], .chip.is-on{background:var(--green); color:var(--green-ink); border-color:var(--green)}
  .chip:focus-visible{outline:3px solid var(--focus); outline-offset:2px}
  .input{display:flex; gap:8px; align-items:center}
  input[type=email]{flex:1; background:#0c1117; border:1.5px solid var(--stroke); color:var(--ink); padding:12px 14px; border-radius:12px; font-size:15px; min-height:48px}
  input[type=email]:focus{outline:3px solid var(--focus); outline-offset:2px}
  .inline{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  label.checkbox{display:inline-flex; gap:8px; align-items:center; cursor:pointer; font-weight:700}
  input[type=checkbox]{width:20px; height:20px}
  .switch{border:1.5px solid var(--stroke); border-radius:999px; padding:6px 12px; min-height:44px; min-width:72px; display:inline-flex; align-items:center; gap:8px; cursor:pointer; background:transparent; font-weight:800}
  .switch.is-on{background:var(--green); color:var(--green-ink); border-color:var(--green)}
  .tools{position:sticky; bottom:8px; z-index:5; display:flex; gap:8px; justify-content:flex-end; margin-top:12px}
  .btn{background:#0c1117; border:1.5px solid var(--stroke); color:var(--ink); border-radius:12px; padding:12px 14px; font-weight:900; cursor:pointer; min-height:48px}
  .btn.primary{background:var(--green); color:var(--green-ink); border-color:var(--green)}
  .btn:focus-visible{outline:3px solid var(--focus); outline-offset:2px}
  .error{color:var(--red); font-weight:800; font-size:12px; margin-top:6px}
  .error[hidden]{display:none}
  .help{color:var(--muted); font-size:12px}
  .preview{white-space:pre-wrap; word-break:break-word; background:#0c1117; border:1px dashed var(--stroke); border-radius:12px; padding:12px; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px}
  .sr{position:absolute!important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
  .stack{display:grid; gap:12px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand"><span class="badge" aria-hidden="true">Green</span><h1>Interests & Persona</h1></div>
      <small class="help">≤ 60s</small>
    </header>

    <form id="form" class="stack" novalidate>
      <!-- BASICS -->
      <section class="card" aria-labelledby="basics-h">
        <fieldset role="group" aria-label="Basics">
          <legend id="basics-h">Basics</legend>

          <div class="input" title="Work email">
            <label for="email" class="sr">Email</label>
            <input id="email" name="email" type="email" inputmode="email" autocomplete="email" placeholder="Email*" aria-describedby="err-email" required />
          </div>
          <div id="err-email" class="error" aria-live="polite" hidden></div>

          <div class="group">
            <div class="sub">Age</div>
            <div class="row" id="age" role="radiogroup" aria-label="Age" data-select="single">
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="18-24" title="18–24">18–24</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="25-34" title="25–34">25–34</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="35-44" title="35–44">35–44</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="45-54" title="45–54">45–54</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="55+" title="55+">55+</button>
            </div>
          </div>

          <div class="group">
            <div class="sub">Region</div>
            <div class="row" id="region" role="radiogroup" aria-label="Region" data-select="single">
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="HE" title="HE — Hessen">Hessen (HE)</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="BY" title="BY — Bayern">Bayern (BY)</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="BW" title="BW — Baden‑Württemberg">Baden‑Württ. (BW)</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="NRW" title="NRW — Nordrhein‑Westfalen">NRW</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="BE" title="BE — Berlin">Berlin (BE)</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="HH" title="HH — Hamburg">Hamburg (HH)</button>
            </div>
          </div>

          <div class="group">
            <div class="sub">Household</div>
            <div class="row" id="household" role="radiogroup" aria-label="Household" data-select="single">
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="1" title="1 person">1</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="2" title="2 persons">2</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="3" title="3 persons">3</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="4+" title="4 or more">4+</button>
            </div>
          </div>

          <div class="group">
            <div class="sub">Housing</div>
            <div class="row" id="housing" role="radiogroup" aria-label="Housing" data-select="single">
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="apartment" title="Apartment">Apartment</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="house" title="House">House</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="student" title="Student">Student</button>
            </div>
          </div>
        </fieldset>
      </section>

      <!-- ENERGY -->
      <section class="card" aria-labelledby="energy-h">
        <fieldset role="group" aria-label="Energy">
          <legend id="energy-h">Energy</legend>

          <div class="group">
            <div class="sub">Heating</div>
            <div class="row" id="heating" role="radiogroup" aria-label="Heating" data-select="single">
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="gas" title="Gas">Gas</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="district" title="District">District</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="heat_pump" title="Heat Pump">Heat Pump</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="electric" title="Electric">Electric</button>
            </div>
          </div>

          <div class="group">
            <div class="sub">Tariff</div>
            <div class="row" id="tariff" role="radiogroup" aria-label="Tariff" data-select="single">
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="fixed" title="Fixed">Fixed</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="dynamic" title="Dynamic">Dynamic</button>
            </div>
          </div>

          <div class="group">
            <div class="sub">Smart Meter</div>
            <div class="inline" aria-label="Smart Meter">
              <button type="button" id="smartMeter" role="switch" aria-checked="false" class="switch" title="Smart Meter">
                <span>Smart</span>
                <span aria-hidden="true">•</span>
                <span id="smartLabel">Off</span>
              </button>
            </div>
          </div>
        </fieldset>
      </section>

      <!-- DEVICES -->
      <section class="card" aria-labelledby="devices-h">
        <fieldset role="group" aria-label="Devices">
          <legend id="devices-h">Devices</legend>
          <div class="row" id="devices" role="group" aria-label="Devices" data-select="multi">
            <button type="button" class="chip" aria-pressed="false" data-value="ev" title="EV">EV</button>
            <button type="button" class="chip" aria-pressed="false" data-value="pv" title="PV/Balcony">PV</button>
            <button type="button" class="chip" aria-pressed="false" data-value="heat_pump" title="Heat Pump">HP</button>
            <button type="button" class="chip" aria-pressed="false" data-value="smart_plugs" title="Smart Plugs">Plugs</button>
            <button type="button" class="chip" aria-pressed="false" data-value="smart_thermostat" title="Smart Thermostat">Thermo</button>
          </div>
        </fieldset>
      </section>

      <!-- ROUTINE -->
      <section class="card" aria-labelledby="routine-h">
        <fieldset role="group" aria-label="Routine">
          <legend id="routine-h">Routine</legend>
          <div class="group">
            <div class="sub">Commute</div>
            <div class="row" id="commute" role="group" aria-label="Commute Days" data-select="multi">
              <button type="button" class="chip" aria-pressed="false" data-value="Mon" title="Monday">Mon</button>
              <button type="button" class="chip" aria-pressed="false" data-value="Tue" title="Tuesday">Tue</button>
              <button type="button" class="chip" aria-pressed="false" data-value="Wed" title="Wednesday">Wed</button>
              <button type="button" class="chip" aria-pressed="false" data-value="Thu" title="Thursday">Thu</button>
              <button type="button" class="chip" aria-pressed="false" data-value="Fri" title="Friday">Fri</button>
            </div>
          </div>
          <div class="group">
            <div class="sub">Home Hours</div>
            <div class="row" id="homeHours" role="radiogroup" aria-label="Home Hours" data-select="single">
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="Evening" title="Evening">Evening</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="Night" title="Night">Night</button>
              <button type="button" class="chip" role="radio" aria-checked="false" data-value="Mixed" title="Mixed">Mixed</button>
            </div>
          </div>
        </fieldset>
      </section>

      <!-- INTERESTS -->
      <section class="card" aria-labelledby="interests-h">
        <fieldset role="group" aria-label="Interests">
          <legend id="interests-h">Interests</legend>
          <div class="row" id="interests" role="group" aria-label="Interests" data-select="multi">
            <button type="button" class="chip" aria-pressed="false" data-value="mobility" title="Mobility">Mobility</button>
            <button type="button" class="chip" aria-pressed="false" data-value="home-efficiency" title="Home Efficiency">Home Efficiency</button>
            <button type="button" class="chip" aria-pressed="false" data-value="low-effort" title="Low Effort">Low Effort</button>
            <button type="button" class="chip" aria-pressed="false" data-value="cost-saving" title="Cost Saving">Cost Saving</button>
            <button type="button" class="chip" aria-pressed="false" data-value="learning" title="Learning">Learning</button>
          </div>
        </fieldset>
      </section>

      <!-- GOALS & CONSTRAINTS -->
      <section class="stack">
        <section class="card" aria-labelledby="goals-h">
          <fieldset role="group" aria-label="Goals">
            <legend id="goals-h">Goals</legend>
            <div class="row" id="goals" role="group" aria-label="Goals" data-select="multi">
              <button type="button" class="chip" aria-pressed="false" data-value="reduce-co2" title="Reduce CO2">Reduce CO₂</button>
              <button type="button" class="chip" aria-pressed="false" data-value="save-money" title="Save Money">Save Money</button>
              <button type="button" class="chip" aria-pressed="false" data-value="get-rewards" title="Get Rewards">Get Rewards</button>
            </div>
          </fieldset>
        </section>
        <section class="card" aria-labelledby="constraints-h">
          <fieldset role="group" aria-label="Constraints">
            <legend id="constraints-h">Constraints</legend>
            <div class="row" id="constraints" role="group" aria-label="Constraints" data-select="multi">
              <button type="button" class="chip" aria-pressed="false" data-value="landlord" title="Landlord">Landlord</button>
              <button type="button" class="chip" aria-pressed="false" data-value="low-budget" title="Low Budget">Low Budget</button>
              <button type="button" class="chip" aria-pressed="false" data-value="accessibility" title="Accessibility">Accessibility</button>
              <button type="button" class="chip" aria-pressed="false" data-value="time-poor" title="Time‑Poor">Time‑Poor</button>
            </div>
          </fieldset>
        </section>
      </section>

      <!-- PREFERENCES -->
      <section class="card" aria-labelledby="pref-h">
        <fieldset role="group" aria-label="Preferences">
          <legend id="pref-h">Preferences</legend>
          <div class="row" id="weighting" role="radiogroup" aria-label="Weighting" data-select="single">
            <button type="button" class="chip" role="radio" aria-checked="false" data-value="balanced" title="Balanced">Balanced</button>
            <button type="button" class="chip" role="radio" aria-checked="false" data-value="low-effort" title="Low Effort">Low Effort</button>
            <button type="button" class="chip" role="radio" aria-checked="false" data-value="high-impact" title="High Impact">High Impact</button>
            <button type="button" class="chip" role="radio" aria-checked="false" data-value="cost-saving" title="Cost Saving">Cost Saving</button>
          </div>
        </fieldset>
      </section>

      <!-- CONSENT -->
      <section class="card" aria-labelledby="consent-h">
        <fieldset role="group" aria-label="Consent">
          <legend id="consent-h">Consent</legend>
          <div class="inline" aria-describedby="err-consent">
            <label class="checkbox" title="Photos">
              <input type="checkbox" value="photos" id="consent-photos" />
              <span>Photos</span>
            </label>
            <label class="checkbox" title="Receipts">
              <input type="checkbox" value="receipts" id="consent-receipts" />
              <span>Receipts</span>
            </label>
            <label class="checkbox" title="App Exports">
              <input type="checkbox" value="appExports" id="consent-exports" />
              <span>App Exports</span>
            </label>
            <label class="checkbox" title="I agree">
              <input type="checkbox" required id="agree" />
              <span>I agree</span>
            </label>
          </div>
          <div id="err-consent" class="error" aria-live="polite" hidden></div>
        </fieldset>
      </section>

      <div class="tools">
        <button type="button" class="btn" id="resetBtn" title="Reset">Reset</button>
        <button type="submit" class="btn primary" id="submitBtn" title="Submit">Submit</button>
      </div>

      <section id="previewCard" class="card" hidden>
        <legend class="sr">Preview</legend>
        <div class="inline" style="justify-content:space-between; align-items:center; margin-bottom:8px">
          <strong>JSON</strong>
          <button type="button" class="btn" id="copyBtn" title="Copy JSON">Copy</button>
        </div>
        <div id="preview" class="preview" aria-live="polite"></div>
      </section>
    </form>
  </div>

<script>
(function(){
  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

  function initChips(){
    $$('[data-select="single"]').forEach(group=>{
      group.addEventListener('click', e=>{
        const btn = e.target.closest('button.chip');
        if(!btn) return;
        $$('.chip[role="radio"]', group).forEach(b=>b.setAttribute('aria-checked','false'));
        btn.setAttribute('aria-checked','true');
      });
    });
    $$('[data-select="multi"]').forEach(group=>{
      group.addEventListener('click', e=>{
        const btn = e.target.closest('button.chip');
        if(!btn) return;
        const pressed = btn.getAttribute('aria-pressed') === 'true';
        btn.setAttribute('aria-pressed', String(!pressed));
      });
    });
  }

  function initSwitch(){
    const sw = $('#smartMeter');
    const lab = $('#smartLabel');
    sw.addEventListener('click', ()=>{
      const on = sw.getAttribute('aria-checked') === 'true';
      sw.setAttribute('aria-checked', String(!on));
      sw.classList.toggle('is-on', !on);
      lab.textContent = !on ? 'On' : 'Off';
    });
  }

  function valSingle(groupId){
    const g = $('#'+groupId);
    if(!g) return undefined;
    const sel = g.querySelector('[aria-checked="true"]');
    return sel ? sel.dataset.value : undefined;
  }

  function valMulti(groupId){
    const g = $('#'+groupId);
    if(!g) return [];
    return $$('.chip[aria-pressed="true"]', g).map(b=>b.dataset.value);
  }

  function serialize(){
    const email = $('#email').value.trim();
    const smart = $('#smartMeter').getAttribute('aria-checked') === 'true';

    const data = {
      email: email || '',
      profile: {
        region: valSingle('region') || null,
        ageBand: valSingle('age') || null,
        householdSize: valSingle('household') || null,
        housingType: valSingle('housing') || null
      },
      energy: {
        heating: valSingle('heating') || null,
        tariff: valSingle('tariff') || null,
        smartMeter: smart
      },
      devices: valMulti('devices'),
      routine: {
        commuteDays: valMulti('commute'),
        homeHours: valSingle('homeHours') || null
      },
      interests: valMulti('interests'),
      goals: valMulti('goals'),
      constraints: valMulti('constraints'),
      weighting: valSingle('weighting') || null,
      consent: ['photos','receipts','appExports'].filter(k=>{
        if(k==='photos') return $('#consent-photos').checked;
        if(k==='receipts') return $('#consent-receipts').checked;
        if(k==='appExports') return $('#consent-exports').checked;
      }),
      timestamp: new Date().toISOString()
    };
    return data;
  }

  function validate(){
    let ok = true;
    const email = $('#email');
    const agree = $('#agree');
    const emailErr = $('#err-email');
    const consentErr = $('#err-consent');

    if(!email.value.trim()){
      emailErr.textContent = 'Email required';
      emailErr.hidden = false; email.setAttribute('aria-invalid','true');
      ok = false;
    } else if(!email.checkValidity()){
      emailErr.textContent = 'Email invalid';
      emailErr.hidden = false; email.setAttribute('aria-invalid','true');
      ok = false;
    } else { emailErr.hidden = true; email.removeAttribute('aria-invalid'); }

    if(!agree.checked){
      consentErr.textContent = 'Agree required';
      consentErr.hidden = false; agree.setAttribute('aria-invalid','true');
      ok = false;
    } else { consentErr.hidden = true; agree.removeAttribute('aria-invalid'); }

    return ok;
  }

  function showPreview(data){
    const card = $('#previewCard');
    const pre = $('#preview');
    pre.textContent = JSON.stringify(data); // compact
    card.hidden = false;
  }

  function copyJSON(){
    const txt = $('#preview').textContent;
    if(!txt) return;
    navigator.clipboard.writeText(txt).then(()=>{
      const btn = $('#copyBtn');
      const prev = btn.textContent; btn.textContent = 'Copied';
      setTimeout(()=>btn.textContent = prev, 900);
    });
  }

  function resetAll(){
    $('#form').reset();
    $$('[role="radiogroup"]').forEach(g=>$$('.chip[role="radio"]', g).forEach(b=>b.setAttribute('aria-checked','false')));
    $$('[data-select="multi"]').forEach(g=>$$('.chip', g).forEach(b=>b.setAttribute('aria-pressed','false')));
    const sw = $('#smartMeter'); sw.setAttribute('aria-checked','false'); sw.classList.remove('is-on'); $('#smartLabel').textContent = 'Off';
    $('#err-email').hidden = true; $('#err-consent').hidden = true;
    $('#previewCard').hidden = true; $('#preview').textContent = '';
  }

  initChips(); initSwitch();

  $('#form').addEventListener('submit', (e)=>{ e.preventDefault(); if(!validate()) return; showPreview(serialize()); });
  $('#copyBtn').addEventListener('click', copyJSON);
  $('#resetBtn').addEventListener('click', resetAll);
})();
</script>
</body>
</html>